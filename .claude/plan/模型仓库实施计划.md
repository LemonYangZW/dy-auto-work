# 模型仓库 (Model Library) 实施计划

## 概述

将 models.dev API 数据独立为「模型库」面板，用户在此浏览/搜索/启用模型，
AI 服务配置面板的下拉框仅显示用户已启用的模型子集。

## 架构

```
models.dev API → fetchAllProviders() (缓存)
                      ↓
             ModelLibraryPanel (浏览 + 搜索 + Switch 启用)
                      ↓
             useModelStore (Zustand + localStorage 持久化)
                      ↓
             ModelSelect (仅展示 store 中已启用的模型)
```

## 实施步骤

### Step 1: 创建 Zustand Store
- 文件: `src/stores/useModelStore.ts`
- 功能: enabledModels (Record<providerId, modelId[]>)
- 方法: toggleModel, enableModels, disableAll, isEnabled
- 持久化: zustand/middleware persist → localStorage
- 默认白名单: openai/gpt-4o, anthropic/claude-sonnet-4, google/gemini-2.5-flash, deepseek/deepseek-chat

### Step 2: 创建 useAllProviders Hook
- 文件: `src/hooks/useModelsDevData.ts` (追加)
- 功能: useAllProviders() → { providers, isLoading, error }
- 包装 fetchAllProviders()，按 category 过滤

### Step 3: 创建 ModelLibraryPanel
- 文件: `src/features/settings/panels/ModelLibraryPanel.tsx`
- 组件结构:
  ```
  ModelLibraryPanel
  ├── 标题 + 描述
  ├── 工具栏
  │   ├── 搜索框 (Input + Search icon)
  │   └── 分类标签 (Tabs: 全部 | LLM | 图像 | 视频 | 语音)
  └── Provider 分组列表
      ├── Provider Header (名称 + Badge 模型数)
      └── ModelCard Grid (1-2列)
          └── ModelCard
              ├── 模型名 + ID
              ├── 指标 (上下文长度, 费用)
              └── Switch (启用/禁用)
  ```

### Step 4: 更新 SettingsPage 导航
- 在 NAV_ITEMS 中新增 `{ id: "library", label: "模型库", icon: Library, group: "AI 服务" }`
- 在 PANEL_MAP 中注册 ModelLibraryPanel
- 放在 AI 服务组第一位

### Step 5: 改造 ModelSelect
- 从 useModelStore 读取 enabledModels[providerId]
- 用 enabledIds 过滤 models 列表
- 空状态: 显示「请先在模型库中启用模型」提示
- 保留 loading/error 状态处理

### Step 6: 构建验证
- npm run build 确认零错误

## 文件清单

| 操作 | 文件路径 |
|------|---------|
| 新建 | `src/stores/useModelStore.ts` |
| 修改 | `src/hooks/useModelsDevData.ts` (追加 useAllProviders) |
| 新建 | `src/features/settings/panels/ModelLibraryPanel.tsx` |
| 修改 | `src/features/settings/SettingsPage.tsx` (导航 + 面板映射) |
| 修改 | `src/features/settings/components/ModelSelect.tsx` (store 过滤) |
